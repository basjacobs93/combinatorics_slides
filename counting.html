<!DOCTYPE html>
<html>
  <head>
    <title>Counting things</title>
    <meta charset="utf-8">
    <meta name="author" content="Bas Jacobs" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Counting things
### Bas Jacobs
### 2019/01/11

---




background-image: url(card_overlaps_problem.png)
background-size: contain

---
class: inverse, center, middle

# Simulating!

---


```python
from numpy.random import choice
```
--

```python
n_experiments = 100000
overlaps = np.zeros(n_experiments)
for i in range(n_experiments):
    shop_1 = choice(2000, size = 100, replace = False)
    shop_2 = choice(2000, size = 100, replace = False)
    overlap = len(set(shop_1) &amp; set(shop_2))
    overlaps[i] = overlap
```
--

```python
plt.hist(overlaps, bins = np.unique(overlaps))
```

![hist](card_overlaps_hist.png)

---

class: inverse, center, middle

# But what if we want an exact answer?

---

class: center, middle

# Combinatorics

_Combinatorics is the branch of mathematics studying the **enumeration**, **combination**, and **permutation** of sets of elements and the mathematical relations that characterize their properties._&lt;sup&gt;1&lt;sup&gt;

.footnote[
[1] http://mathworld.wolfram.com/Combinatorics.html
]

---

# Today

 - Some kind of _Combinatorics 101_ (but not with balls and urns)
 - Problem examples and approaches to solve them

---

# Shuffling cards

 - In how many ways can the letters `cards` be ordered?
 - `cards`, `carsd`, ..., `arscd`
 
---

# Shuffling cards


`_ _ _ _ _`
--
  
`a _ _ _ _` `\(\qquad 5\)`  
--
  
`a d _ _ _` `\(\qquad 5\cdot 4\)`  
--
  
`a d c _ _` `\(\qquad 5\cdot 4\cdot 3\)`  
--
  
`a d c r _` `\(\qquad 5\cdot 4\cdot 3 \cdot 2\)`  
--
  
`a d c r s` `\(\qquad 5\cdot 4\cdot 3 \cdot 2 \cdot 1\)`  

---

# Permutations

`\(n\)` items can be reordered in `\(n! = n\cdot(n-1)\cdot(n-2)\cdot\ldots \cdot 2\cdot 1\)` ways

---

# Permutations grow fast
Stirling's approximation&lt;sup&gt;1&lt;/sup&gt;

$$ n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$$

  
![](stirling.png)

.footnote[
[1] https://en.wikipedia.org/wiki/Stirling's_approximation
]
---

class: inverse, center, middle
background-image: url(lidl_factorial.jpg)
background-size: contain

# Permutations grow fast

# 362 880

---

In how many ways can we draw 100 unique cards from 2000 possible cards?

--

`$$2000\cdot 1999\cdot 1998\cdot \ldots \cdot 1901$$`
--

`$$= \frac{2000!}{1900!}$$`

--
But the order does not matter!

--
How many reorderings of these 100 cards are there? `\(100!\)`
$$ \frac{2000!}{1900!\cdot100!} = {2000 \choose 100} $$

---
class: inverse
# Combinations

Choosing `\(k\)` objects from `\(n\)` objects without repetition, order does not matter
$$ {n \choose k} = \frac{n!}{k!\cdot (n-k)!}$$

.footnote[
`R`: `choose(n, k)`  
`python`: "Why not write it yourself?"
]
---
# Example

Counting paths on a grid

```
 ----------+     |..........     --+........
 ..........|     |..........     ..+-+......
 ..........|     +--+.......     ....+-+....
 ..........|     ...|.......     ......+-+..
 ..........|     ...|.......     ........|..
 ..........|     ...+-------     ........+--
```

`$${15\choose 5}$$`

.footnote[
  Source: https://nbviewer.jupyter.org/github/norvig/pytudes/blob/master/ipynb/How%20To%20Count%20Things.ipynb
]
---

# Example

Number of combinations of a safe



---

# Calculating overlap

  1) Let shop A choose 100 cards: `\({2000 \choose 100}\)`  
--

  2a) Overlap of 0: `\({1900 \choose 100}\)`  
--
  
  2b) Overlap of 1: `\({100\choose 1}\cdot{1900 \choose 99}\)`  
--
  
  2c) Overlap of `\(n\)`: `\({100\choose n}\cdot{1900\choose 100-n}\)`  
--
  
  3) Number of ways of `\(n\)` overlap: `\({2000 \choose 100}\cdot{100\choose n}\cdot{1900 \choose 100-n}\)`  
--
  
  4) Probability of `\(n\)` overlap: `\({2000 \choose 100}\cdot{100\choose n}\cdot{1900 \choose 100-n} / {2000 \choose 100}{2000 \choose 100}\)`

---


```python
from math import factorial
def choose(n, k): 
    return factorial(n) // factorial(n-k) // factorial(k)
```

--


```python
probs = []
for overlap in range(100):
    probs.append(
        choose(100, overlap) * choose(1900, 100-overlap) /
        choose(2000, 100)
    )
```

![](card_overlaps_fact_hist.png)

---

class: inverse, center, middle
# Hypergeometric distribution&lt;sup&gt;1&lt;/sup&gt;

.footnote[
[1] https://en.wikipedia.org/wiki/Hypergeometric_distribution
]

---

# Sending cards

  - 100 cards 
  - 3 friends to send cards to
  - Every friend should receive at least 1 card
  - In how many ways can we send cards to friends?

---

# Stars and bars

  - Denote every card with a star ★
  - Put them in a row ★ ★ ★ ★ ★ ★ ★ ★ ★ ★
  - We have to place 2 bars in the 99 spaces between the stars 
  `$${99 \choose 2} = 4851$$`

---

# Bootstrapping

In how many ways can we select (with replacement) `\(n\)` observations from a dataset of `\(n\)` observations?

---

# Bootstrapping: example
                                                                                    
In how many ways can we select (with replacement) 10 observations from a dataset of 10 observations?

 | ★ ★ | | | ★ ★ ★ | ★ | ★ ★ | | | ★ ★

[0, 2, 0, 0, 3, 1, 2, 0, 0, 2]

---

# Bootstrapping: in general

  - `\(n\)` stars (observations)
  - `\(n-1\)` bars ()
`$${n + (n-1) \choose n} = {2n-1 \choose n}$$`

For 10 observations, 92378 possible samples!

---

# Python

```python
from itertools import combinations_with_replacement
```

--

```python
%time len(list(combinations_with_replacement(range(10), 10)))
```
```
## CPU times: user 23.8 ms, sys: 679 µs, total: 24.5 ms
## Wall time: 25.6 ms

## 92378
```
  
--
  
```python
%time choose(2*10-1, 10)
```
```
## CPU times: user 19 µs, sys: 4 µs, total: 23 µs
## Wall time: 33.4 µs

## 92378
```

---

# Python
```python
%time len(list(combinations_with_replacement(range(15), 15)))
```
```
## CPU times: user 12.4 s, sys: 4.3 s, total: 16.7 s
## Wall time: 17.3 s

## 77558760
```

--

```python
%time choose(2*15-1, 15)
```
```
## CPU times: user 14 µs, sys: 5 µs, total: 19 µs
## Wall time: 25.3 µs

## 77558760
```
---

# Chess

  - 12 games of chess

`$$(n^{-1}+1+n)^{12}$$`
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
